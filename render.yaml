services:
  # Backend Service (Express + Firestore)
  - type: web
    name: velvet-backend
    env: node
    plan: free
    rootDir: server
    buildCommand: npm install
    startCommand: node index.js
    envVars:
      - key: NODE_VERSION
        value: 20.10.0
      - key: FIREBASE_SERVICE_ACCOUNT
        sync: false # Admin must provide this in Render Dashboard
      - key: CORS_ORIGIN
        value: "*" # Allow all for simplicity, or restrict to frontend URL later

  # Frontend Service (Nuxt SPA served via Node)
  - type: web
    name: velvet-frontend
    env: node
    plan: free
    rootDir: client-nuxt
    buildCommand: npm install && npx nuxt generate
    startCommand: npx serve .output/public -s -p $PORT
    envVars:
      - key: NUXT_PUBLIC_API_HOST
        fromService:
          type: web
          name: velvet-backend
          property: host
      - key: NUXT_PUBLIC_FIREBASE_API_KEY
        sync: false
      - key: NUXT_PUBLIC_FIREBASE_AUTH_DOMAIN
        sync: false
      - key: NUXT_PUBLIC_FIREBASE_PROJECT_ID
        sync: false
      - key: NUXT_PUBLIC_FIREBASE_STORAGE_BUCKET
        sync: false
      - key: NUXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        sync: false
      - key: NUXT_PUBLIC_FIREBASE_APP_ID
        sync: false
